<html>
<head>
<title>MidanAAST Attendance competition</title>
<style>
    canvas,div
    {
        position : absolute;
    }
</style>
</head>
<body>
			       
            <canvas id="canvas" width="100%" height="100%"></canvas>
            <canvas id="tpgraph" width="100%" height="100%"></canvas>
			<div id="logo"> <a href="http://fb.me/midanAAST"><img src="http://yoga1290.appspot.com/midan/logo.png" /></a></div>
			
        <div id="info" class="info"></div>
<script>
    /**
     @author    yoga1290@gmail.com
     @see       http://about.me/yoga1290
     */
     
    /*cache*/

	var midan4sqr="<a href='https://foursquare.com/oauth2/authenticate?client_id=KMZM03DCNBFOS1UDA3LVR5OBGLQQ5IVPZTOJG4XVSF2AZ43E&response_type=code&redirect_uri=http://yoga1290.appspot.com/oauth/midan/foursquare/callback/'><img src='https://playfoursquare.s3.amazonaws.com/press/logo/connect-blue.png'/ ></a>";
    var animate_speed=1;        
                        function        drawChart(curInd,r,R)
            {
 //              console.log("drawChart("+curInd+","+r+","+R+");");
                var i;
                var canvas = document.getElementById("canvas");
                
                canvas.style.top=0;
                canvas.style.left=0;
                canvas.width=window.screen.width;
                canvas.height=window.screen.height;
                
                var context = canvas.getContext("2d");
                var centerX = canvas.width / 2;
                var centerY = canvas.height / 2;
                var radius = Math.min(centerX,centerY);
                var startingAngle,endingAngle;
                var lastAngle = 0;
                var counterclockwise = false;
                
                checkinsCount.sort();
                // Draw the 1s with bigger area first
                for(i=checkinsCount.length-1;i>=0;i--)
                {
                    if(i==curInd)
                    radius=R;
                    else
                    radius=r;
                    
                    context.beginPath();
                    startingAngle=lastAngle;
                    endingAngle=startingAngle+Math.PI*2*(checkinsCount[i]/max_checkin);
                    
                    context.arc(centerX, centerY, radius, startingAngle, endingAngle, counterclockwise);
                    context.closePath();
                    
                    
                    context.fillStyle=color[i];
                    context.fill();
                    
                    //triangle
                    context.beginPath(); // begin custom shape
                    context.moveTo(centerX, centerY);
                    context.lineTo(centerX+Math.cos(startingAngle)*radius ,centerY+Math.sin(startingAngle)*radius);
                    context.lineTo(centerX+Math.cos(endingAngle)*radius ,centerY+Math.sin(endingAngle)*radius);
                    context.lineTo(centerX,centerY);
                    context.closePath();
                    context.fill();
                    lastAngle=endingAngle;
                }
drawTimepiece(curInd,r);
                //        window.onresize=drawChart();
            }
            
            
                      function        drawTimepiece(curInd,R)
            {
   //            console.log("drawTimepiece("+curInd+","+R+");");
                var i;
                var canvas = document.getElementById("tpgraph");
                var max=timedata[curInd][0];
                for(i=0;i<12;i++)
                    max=Math.max(max,timedata[curInd][i]);
                
//               console.log(timedata[curInd]);
//                canvas.width=window.screen.width;
//                canvas.height=window.screen.height;
                canvas.width=R<<1;
                canvas.height=R<<1;
                canvas.style.top=(window.screen.height-canvas.width)>>1;
                canvas.style.left=(window.screen.width-canvas.width)>>1;
                
                var context = canvas.getContext("2d");
                var centerX = canvas.width / 2;
                var centerY = canvas.height / 2;
                var radius = Math.min(centerX,centerY);
                var startingAngle,endingAngle;
                var lastAngle =1.5*Math.PI;//as 12:00 starts at [0]//0;
                var counterclockwise = false;
                
                context.setLineWidth=100;
                context.strokeStyle="#0000FF";
                
                context.font="20px Arial";
                for(i=0;i<12;i++)
                {
                    //12 at [0] (as 12%12==0)
                    //9AM at 0¼
                    radius=timedata[curInd][i]*R/max;
                    
                    
                    startingAngle=lastAngle;
                    endingAngle=startingAngle+Math.PI*2/12;//12 hour graph
                    

                    //context.fillStyle=color[curInd];//"#0FF00F";
                    
                    
//                    if(timedata[curInd][i]>0)
  //                  {
    //                		context.fillStyle="#0000FF";
      //              		context.fillText(	(	i+":00 ~ "+((i+1)%12)+":00 ("+timedata[curInd][i]+")"	)	,centerX+Math.cos(startingAngle)*radius ,centerY+Math.sin(startingAngle)*radius	);
        //            	}
                    	
                    	context.fillStyle=color[curInd];
                    	
                    //triangle
                    
                    context.beginPath(); // begin custom shape
                    context.moveTo(centerX, centerY);
                    context.lineTo(centerX+Math.cos(startingAngle)*radius ,centerY+Math.sin(startingAngle)*radius);
                    context.lineTo(centerX+Math.cos(endingAngle)*radius ,centerY+Math.sin(endingAngle)*radius);
                    context.lineTo(centerX,centerY);
                    context.closePath();
                    context.fill();
                    
                    context.stroke();
                    
                   context.fillStyle="#00FF00";//color[curInd];
                    
                    context.beginPath();
                    context.arc(centerX+Math.cos(startingAngle)*radius ,centerY+Math.sin(startingAngle)*radius, 5, 0, Math.PI<<1, counterclockwise);
                    context.closePath();
                    context.fill();
                    if(timedata[curInd][i]>0)
                    {
//                    		context.fillStyle="#00FF00";
                    		context.fillText(	(	i+":00 ~ "+((i+1)%12)+":00 ("+timedata[curInd][i]+")"	)	,centerX+Math.cos(startingAngle)*radius ,centerY+Math.sin(startingAngle)*radius	);
                    	}
                    	
                    	context.fillStyle=color[curInd];
                    	
                    lastAngle=endingAngle;
                }
            }
            
            function animate(i,r,zoomIn)
            {
//                console.log("animate("+i+","+r+","+zoomIn+");");
                var canvas = document.getElementById("canvas");
                if(zoomIn==1)
                {
                    if(r<Math.min(canvas.width / 2,canvas.height / 2))
                    {
                        drawChart(i,(Math.min(canvas.width/2,canvas.height/2)-r),r+animate_speed);
                        setTimeout("animate("+i+","+(r+animate_speed)+",1);",50);
                    }
                    else
                    {
                        drawChart(i,(Math.min(canvas.width/2,canvas.height/2)-r+animate_speed),r-animate_speed);
                            setTimeout("animate("+i+","+(r-animate_speed)+",0);",1000);
                    }
                }
                else
                {
                    if(r<=0)
                    {
                    		i=(i+1)%checkinsCount.length;
                    		document.getElementById("info").innerHTML="<table><tr><td align='center'><img src='"+ppic[i]+"'/ ></td></tr><tr><td align='center'><a href='http://foursquare.com/user/"+userId[i]+"'>"+username[i]+"</a> ("+checkinsCount[i]+")<br>"+midan4sqr+"</td></tr></table>";
                    		setTimeout("animate("+i+","+(r-animate_speed)+",1);",2000);
                    	}
                    	else
                    	{
	                    drawChart(i,(Math.min(canvas.width/2,canvas.height/2)-r+animate_speed),r-animate_speed);
                    		setTimeout("animate("+i+","+(r-animate_speed)+",0);",50);
                    	}
                }
            
            }
            
            document.getElementById("logo").style.left=(window.screen.width-161)>>1;
            document.getElementById("logo").style.top=(window.screen.height-147)>>1;
            
            document.getElementById("info").style.left=(window.screen.width-110)>>1;
            document.getElementById("info").style.top=(window.screen.height-200);
            
            animate_speed=Math.min(window.screen.width,window.screen.height)*5/100;
            if(userId.length>0)
				document.getElementById("info").innerHTML="<table><tr><td align='center'><img src='"+ppic[0]+"'/ ></td></tr><tr><td align='center'><a href='http://foursquare.com/user/"+userId[0]+"'>"+username[0]+"</a> ("+checkinsCount[0]+")<br>"+midan4sqr+"</td></tr></table>";
            animate(0,0,1);
            </script>
    </body>
</html>